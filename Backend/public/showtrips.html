<!-- bearbeitet von Marcia Perez Heilig -->

<!-- Page displaying all Trips -->

<html>
    <head>
        <title>Travel Planner - Show Trips</title>
        <link rel="stylesheet" type="text/css" href="./css/default.css">
    </head>
    <body>
        <h1>Travel Planner</h1>
            
        <div class="displayCard">
            <h2>Trip Collection</h2>
            <div class="tripList">
                
            </div>

            <div>
                <a href="/createtrip.html">Create New Trip</a>
                <button id="deleteAllButton" class="alarmButton">Delete All Trips</button>
            </div>
        </div>
        
        <a href="/index.html">Back</a>
        
        
        <!-- JavaScript for querying-->
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                // Select the tripList section and the deleteAllButton
                const tripList = document.querySelector('.tripList');
                const deleteAllButton = document.getElementById('deleteAllButton');

                // Function to fetch and display trips
                const loadTrips = () => {
                    axios.get('/api/trips')
                        .then(response => {
                            const trips = response.data;

                            // Handle empty trips array
                            if (trips.length === 0) {
                                tripList.innerHTML = '<p>No trips added yet.<br>Better start planning!</p>';
                                deleteAllButton.style.display = 'none';
                                return;
                            }

                            // Clear existing content
                            tripList.innerHTML = '';

                            // Loop through each trip and create the HTML structure
                            trips.forEach(trip => {
                                const listItem = document.createElement('div');
                                listItem.className = "listItem";

                                // Create and append elements for each property
                                listItem.innerHTML = `
                                    <h3>Trip: ${trip._name}</h3>
                                    <p>Departure Date: ${trip._departure_date}</p>
                                    <p>Return Date: ${trip._return_date}</p>
                                    <p>Country: ${trip._dest_country}</p>
                                    <p>Tourguide: ${trip._tourguide}</p>
                                    <button class="editButton"><span class="editBtn"></span>Edit</button>
                                    <button class="deleteButton">Delete</button>
                                `;

                                // Add edit functionality
                                const editButton = listItem.querySelector('.editButton');
                                editButton.addEventListener('click', () => navigateToEditPage(trip._id));

                                // Add delete functionality
                                const deleteButton = listItem.querySelector('.deleteButton');
                                deleteButton.addEventListener('click', () => deleteTrip(trip._id));

                                tripList.appendChild(listItem);
                            });
                        })
                        .catch(error => {
                            console.error('Error loading trips:', error);
                            tripList.innerHTML = '<p class="error">Error! Can\'t load trips.</p>';
                        });
                };
                // Function to move to Edit Trip page and store Trip Id
                function navigateToEditPage(tripId) {
                    axios.post('/api/selectedTrip', { tripId })
                        .then(() => {
                            window.location.href = '/edittrip.html'; // Redirect to the edit page
                        })
                        .catch(error => {
                            console.error('Error saving trip ID:', error);
                        });
                }

                // Function to delete a single trip
                const deleteTrip = (tripId) => {
                    if (confirm('Are you sure you want to delete this trip?')) {
                        axios.delete(`/api/trips/${tripId}`)
                            .then(() => {
                                alert('Trip deleted successfully!');
                                loadTrips(); // Reload the trips list
                            })
                            .catch(error => {
                                console.error('Error deleting trip:', error);
                                alert('Failed to delete trip. Please try again.');
                            });
                    };
                };

                // Function to delete all trips
                const deleteAllTrips = () => {
                    if (confirm('Are you sure you want to delete all trips? There\'s no turning back!')) {
                        axios.delete('/api/trips')
                            .then(() => {
                                alert('All trips deleted successfully!');
                                loadTrips(); // Reload the trips list
                            })
                            .catch(error => {
                                console.error('Error deleting all trips:', error);
                                alert('Failed to delete all trips. Please try again.');
                            });
                    };
                };

                // Attach event listener to the delete all button
                deleteAllButton.addEventListener('click', deleteAllTrips);

                // Automatically load trips when the page is loaded
                loadTrips();
            });
        </script>
    </body>
</html>