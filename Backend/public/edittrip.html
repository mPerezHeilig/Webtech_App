<!-- bearbeitet von Marcia Perez Heilig -->

<!-- Page showing form for editing an existing trip -->

<html>
    <head>
        <title>Travel Planner - Edit Trip</title>
        <link rel="stylesheet" type="text/css" href="./css/default.css">
    </head>
    <body>
        <h1>Travel Planner</h1>

        <div class="displayCard">
            <form class="tripForm">
                <h2>Edit Trip</h2>

                <div class="form-group">
                    <label for="departure_date">Departure Date:</label>
                    <input type="date" id="departure_date" name="departure_date">
                </div>

                <div class="form-group">
                    <label for="return_date">Return Date:</label>
                    <input type="date" id="return_date" name="return_date">
                </div>

                <div class="form-group">
                    <label for="country">Country:</label>
                    <select id="country" name="country">
                        <option value="" disabled selected>Choose Country</option>
                        <option value="Spain">Spain</option>
                        <option value="Germany">Germany</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="tourguide">Tourguide:</label>
                    <select id="tourguide" name="tourguide">
                        <option value="" disabled selected>Choose Tourguide</option>
                        <option value="Miguel">Miguel</option>
                        <option value="Hans">Hans</option>
                    </select>
                <div class="form-group"></div>
                
                <div class="form-group">
                    <button type="button" id="submitButton" class="alarmButton">Update Trip</button>
                </div>
            </form>
        </div>

        <a href="/index.html">Back</a>

        
        <!-- JavaScript for querying-->
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
            const form = document.querySelector('.tripForm');
            const submitButton = document.getElementById('submitButton');

            const loadTripData = (tripId) => {
                axios.get(`/api/trips/${tripId}`)
                    .then(response => {
                        const trip = response.data;
                        document.getElementById('departure_date').value = trip._departure_date;
                        document.getElementById('return_date').value = trip._return_date;
                        document.getElementById('country').value = trip._dest_country;
                        document.getElementById('tourguide').value = trip._tourguide;
                    })
                    .catch(error => {
                        console.error('Error fetching trip data:', error);
                        alert('Error loading trip details.');
                    });
            };
        
            const updateTrip = (tripId) => {
                const updatedTrip = {
                    departure_date: document.getElementById('departure_date').value,
                    return_date: document.getElementById('return_date').value,
                    dest_country: document.getElementById('country').value,
                    tourguide: document.getElementById('tourguide').value,
                };
            
                axios.put(`/api/trips/${tripId}`, updatedTrip)
                    .then(() => {
                        alert('Trip updated successfully!');
                        window.location.href = '/showtrips.html'; // Redirect
                    })
                    .catch(error => {
                        console.error('Error updating trip:', error);
                        alert('Error updating trip.');
                    });
            };
        
            axios.get('/api/selectedTrip')
                .then(response => {
                    const tripId = response.data.tripId;
                    if (tripId) {
                        loadTripData(tripId);
                    
                        submitButton.addEventListener('click', (event) => {
                            event.preventDefault();
                            updateTrip(tripId);
                        });
                    } else {
                        alert('No trip ID found. Redirecting to trips page.');
                        window.location.href = '/showtrips.html';
                    }
                })
                .catch(error => {
                    console.error('Error retrieving trip ID:', error);
                    alert('Error initializing edit page.');
                });
            });
        </script>

    </body>
</html>